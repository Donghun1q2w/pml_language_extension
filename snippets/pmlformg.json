{
    "New PML Form Definition": {
        "prefix": "pmlformg",
        "body": [
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|",
            "--| Copyright $CURRENT_YEAR to current year. Company Name. All rights reserved.",
            "--|",
            "--|",
            "--| Other copyright Information goes here!",
            "--|",
            "--| Author: <First Last>",
            "--| Date: \"$CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE\"",
            "--| Filename: \"$TM_FILENAME\"",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "",
            "import 'MarApi'",
            "handle (1000,0)",
            "endhandle",
            "",
            "import 'GridControl'",
            "handle (1000,0)",
            "endhandle",
            "",
            "import 'PMLFileBrowser'",
            "handle (1000,0)",
            "endhandle",
            "",
            "",
            "setup form !!${1:$TM_FILENAME_BASE} size 100 20 VarChars dialog resizable",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "\t!this.formtitle = '${2:New PML Form Title}'",
            "",
            "",
            "\t!this.newMenu(|gridPopup|)",
            "\t!this.gridPopup.add('CALLBACK', 'Clear List', '!this.removeAll()')",
            "\t!this.gridPopup.add('CALLBACK', 'Remove Selected from List', '!this.removeSelected()')",
            "\t!this.gridPopup.add('CALLBACK', 'Export Results to Excel', '!this.exportToExcel()')",
            "",
            "frame .Inputs '' anchor left + top width 30 height 5",
            "\t-- Buttons and other controls should go here!",
            "exit",
            "",
            "path down",
            "",
            "\tframe  .ResultsFrame 'Results' at x0 y7 anchor left + right + top + bottom width 100 height 30",
            "\t\tcontainer .GridFrame NOBOX PMLNetControl dock fill height 20",
            "\texit",
            "",
            "\tmember .gridCtrl is NetGridControl",
            "",
            "\t${0}",
            "",
            "exit",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name : .${1}()",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : This is the construct method",
            "--|  Arguments   : None",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .${1}()",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "",
            "\t!this.GridCtrl = object NetGridControl()",
            "\t!this.GridCtrl.singleRowSelection(false)",
            "\t!this.GridCtrl.editableGrid(false)",
            "\t!this.GridCtrl.Updates(true)",
            "\t!this.GridCtrl.HideGroupByBox(false)",
            "\t!this.GridCtrl.outlookGroupStyle(true)",
            "\t!this.GridCtrl.clearGrid()",
            "\t!this.GridCtrl.columnExcelFilter(true)",
            "\t!this.GridFrame.Control = !this.GridCtrl.handle()",
            "\t!this.gridCtrl.addeventhandler('OnPopup', !this, 'rightClickGrid')",
            "",
            "\t!this.initializeEmptyGrid()",
            "",
            "endmethod",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name : .rightClickGrid()",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : Defines right click trigger functionality",
            "--|  Arguments   : None",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .rightClickGrid(!data is array)",
            "",
            "\t!this.gridFrame.popup = !this.gridPopup",
            "\t!this.gridFrame.showPopup(!data[0], !data[1])",
            "endmethod",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name : .removeAll()",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : Removes all grid Contents",
            "--|  Arguments   : None",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .removeAll()",
            "",
            "\t!this.gridCtrl.cleargrid()",
            "\t!this.initializeEmptyGrid()",
            "",
            "endmethod",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name :.removeSelected()",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : Removes Selected rows from Grid",
            "--|  Arguments   : None",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .removeSelected()",
            "",
            "\t!this.gridCtrl.deleteSelectedRows()",
            "",
            "\tif !this.gridCtrl.GetRows().Empty() then",
            "\t\t!this.gridCtrl.cleargrid()",
            "\t\t!this.initializeEmptyGrid()",
            "\tendif",
            "",
            "endmethod",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name : .exportToExcel()",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : Exports grid contents to .xls file",
            "--|  Arguments   : None",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .exportToExcel()",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "",
            "\t!ExportPath = |C:\\Temp|",
            "\t!FileName   = |${2}.xls|",
            "",
            "\t!browser    = object PMLFileBrowser('Save')",
            "\t!browser.show(!ExportPath, !FileName, 'Save results', false, 'Excel Files (*.xls)|*.xls', 1)",
            "\tif (!browser.file().eq('')) then",
            "\t\treturn",
            "\telse",
            "\t\t!this.gridCtrl.SaveGridToExcel(!browser.file())",
            "\tendif",
            "",
            "endmethod",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name : .initializeEmptyGrid()",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : Initialize an empty grid & set up the columns",
            "--|  Arguments   : None",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .initializeEmptyGrid()",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "",
            "\t!header = array()",
            "\t!rows   = array()",
            "",
            "\t!header[1] = 'Column1'",
            "\t!header[2] = 'Column2'",
            "",
            "\t!source = object NetDataSource('Results', !header, !rows) ",
            "\t!this.gridCtrl.BindToDataSource(!source)",
            "",
            "endmethod",
            "",
            "",
            "--|------------------------------------------------------------------------------------------------",
            "--|  Method Name : .appendToGrid(!rows)",
            "--|------------------------------------------------------------------------------------------------",
            "--|",
            "--|  Description : Add an array of rows to the grid",
            "--|  Arguments   : !rows is array",
            "--|  Return      : Void",
            "--|",
            "--|------------------------------------------------------------------------------------------------",
            "",
            "define method .appendToGrid(!rows is array)",
            "",
            "\tif !rows.size().gt(0) then",
            "",
            "\t\tdo !row values !rows",
            "\t\t\t!this.gridCtrl.addRow(!row)",
            "\t\tenddo",
            "",
            "\t\t!this.gridCtrl.AutoFitColumns()",
            "",
            "endmethod"


        ],
        "description": "Base for a new PML Form with pre-defined grid"
    }
}