{
    "New PML Form Definition": {
        "prefix": "pmlformg",
        "body": [
            "--------------------------------------------------------------------------------------",
            "--",
            "--",
            "-- Copyright $CURRENT_YEAR to current year. Company Name. All rights reserved.",
            "--",
            "--",
            "-- Other copyright Information goes here!",
            "--",
            "-- Author: <First Last>",
            "-- Date: \"$CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE\"",
            "-- Filename: \"$TM_FILENAME\"",
            "--",
            "--------------------------------------------------------------------------------------",
            "",
            "",
            "import 'MarApi'",
            "handle (1000,0)",
            "endhandle",
            "",
            "import 'GridControl'",
            "handle (1000,0)",
            "endhandle",
            "",
            "import 'PMLFileBrowser'",
            "handle (1000,0)",
            "endhandle",
            "",
            "",
            "setup form !!${1:$TM_FILENAME_BASE} size 100 20 VarChars dialog resizable",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "\t!this.formtitle = '${2:New PML Form Title}'",
            "",
            "",
            "\t!this.newMenu(|gridPopup|)",
            "\t!this.gridPopup.add('CALLBACK', 'Clear List', '!this.removeAll()')",
            "\t!this.gridPopup.add('CALLBACK', 'Remove Selected from List', '!this.removeSelected()')",
            "\t!this.gridPopup.add('CALLBACK', 'Export Results to Excel', '!this.exportToExcel()')",
            "",
            "\tcontainer .GridFrame NOBOX PMLNetControl dock fill height 20 width 80",
            "",
            "\tmember .gridCtrl is NetGridControl",
            "",
            "\t{0}",
            "",
            "exit",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Constructor Method                                                              --",
            "--------------------------------------------------------------------------------------",
            "define method .${1}()",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "",
            "\t!this.GridCtrl = object NetGridControl()",
            "\t!this.GridCtrl.singleRowSelection(false)",
            "\t!this.GridCtrl.editableGrid(false)",
            "\t!this.GridCtrl.Updates(true)",
            "\t!this.GridCtrl.HideGroupByBox(false)",
            "\t!this.GridCtrl.outlookGroupStyle(true)",
            "\t!this.GridCtrl.clearGrid()",
            "\t!this.GridCtrl.columnExcelFilter(true)",
            "\t!this.GridFrame.Control = !this.GridCtrl.handle()",
            "\t!this.gridCtrl.addeventhandler('OnPopup', !this, 'rightClickGrid')",
            "",
            "\t!this.initializeEmptyGrid()",
            "",
            "endmethod",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Method .rightClickGrid() - Defines right click trigger functionality            --",
            "--------------------------------------------------------------------------------------",
            "define method .rightClickGrid(!data is array)",
            "",
            "\t!this.gridFrame.popup = !this.gridPopup",
            "\t!this.gridFrame.showPopup(!data[0], !data[1])",
            "endmethod",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Method .removeAll() - Removes all grid Contents                                 --",
            "--------------------------------------------------------------------------------------",
            "define method .removeAll()",
            "",
            "\t!this.gridCtrl.cleargrid()",
            "\t!this.initializeEmptyGrid()",
            "",
            "endmethod",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Method .removeSelected() - Removes Selected rows from Grid                      --",
            "--------------------------------------------------------------------------------------",
            "define method .removeSelected()",
            "",
            "\t!this.gridCtrl.deleteSelectedRows()",
            "",
            "\tif !this.gridCtrl.GetRows().Empty() then",
            "\t\t!this.gridCtrl.cleargrid()",
            "\t\t!this.initializeEmptyGrid()",
            "\tendif",
            "",
            "endmethod",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Method .exportToExcel() - Exports grid contents to .xls file                    --",
            "--------------------------------------------------------------------------------------",
            "define method .exportToExcel()",
            "",
            "\tusing namespace 'Aveva.Pdms.Presentation'",
            "",
            "\t!ExportPath = |C:\\Temp|",
            "\t!FileName   = |${2}.xls|",
            "",
            "\t!browser    = object PMLFileBrowser('Save')",
            "\t!browser.show(!ExportPath, !FileName, 'Save results', false, 'Excel Files (*.xls)|*.xls', 1)",
            "\tif (!browser.file().eq('')) then",
            "\t\treturn",
            "\telse",
            "\t\t!this.gridCtrl.SaveGridToExcel(!browser.file())",
            "\tendif",
            "",
            "endmethod",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Method .initializeEmptyGrid() - Initialize an empty grid & set up the columns   --",
            "--------------------------------------------------------------------------------------",
            "define method.initializeEmptyGrid()",
            "",
            "\t!header = array()",
            "\t!rows   = array()",
            "",
            "\t!header[1] = 'Column1'",
            "\t!header[2] = 'Column2'",
            "",
            "\t!source = object NetDataSource('Results', !header, !rows) ",
            "\t!this.gridCtrl.BindToDataSource(!source)",
            "",
            "endmethod",
            "",
            "",
            "--------------------------------------------------------------------------------------",
            "--  Method .appendToGrid(!rows) - Add an array of rows to the grid                  --",
            "--------------------------------------------------------------------------------------",
            "define method.appendToGrid(!rows is array)",
            "",
            "\tif !rows.size().gt(0) then",
            "",
            "\t\tdo !row values !rows",
            "\t\t\t!this.gridCtrl.addRow(!row)",
            "\t\tenddo",
            "",
            "\t\t!this.gridCtrl.AutoFitColumns()",
            "",
            "endmethod"


        ],
        "description": "Base for a new PML Form with pre-defined grid"
    }
}